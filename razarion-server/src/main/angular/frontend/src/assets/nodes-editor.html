<!DOCTYPE html>
<html lang="en">
<head>
  <title>three.js webgl - node playground</title>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">
  <link rel="stylesheet" href="http://fonts.cdnfonts.com/css/open-sans" type="text/css"/>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@tabler/icons@latest/iconfont/tabler-icons.min.css">
  <link type="text/css" rel="stylesheet" href="/assets/three-js-examples-main.css">
  <style>
    body {
      overflow: hidden;
      width: 100%;
      height: 100%;
    }

    .renderer {
      position: absolute;
      top: 0;
      left: 0;
      height: 100%;
      width: 100%;
    }

    flow {
      position: absolute;
      top: 0;
      left: 0;
      height: 100%;
      width: 100%;
      box-shadow: inset 0 0 20px 0px #000000;
      pointer-events: none;
    }

    flow f-canvas {
      pointer-events: auto;
    }

    flow f-canvas:not(.focusing) {
      background: #191919ed;
    }
  </style>
</head>
<body>

<script async src="https://unpkg.com/es-module-shims@1.3.6/dist/es-module-shims.js"></script>

<script type="importmap">
			{
				"imports": {
					"three": "https://unpkg.com/three@0.145.0/build/three.module.js",
					"three/addons/": "https://unpkg.com/three@0.145.0/examples/jsm",
					"three/nodes": "https://unpkg.com/three@0.145.0/examples/jsm/nodes/Nodes.js"
				}
			}




</script>
<script type="module">
  import {nodeFrame} from 'https://unpkg.com/three@0.145.0/examples/jsm/renderers/webgl/nodes/WebGLNodes.js';

  import {NodeEditor} from 'https://unpkg.com/three@0.145.0/examples/jsm/node-editor/NodeEditor.js';
  import {MeshEditor} from 'https://unpkg.com/three@0.145.0/examples/jsm/node-editor/scene/MeshEditor.js';
  import {StandardMaterialEditor} from 'https://unpkg.com/three@0.145.0/examples/jsm/node-editor/materials/StandardMaterialEditor.js';

  let nodeEditor;

  window.initNodesEditor = function (scene, mesh) {
    initEditor(scene);

    // showMaterial2(mesh);
    // showMaterial(mesh);

    onWindowResize();

    animate();
  };

  function initEditor(scene) {

    nodeEditor = new NodeEditor(scene);

    document.body.appendChild(nodeEditor.domElement);

    const width = window.innerWidth;
    const height = window.innerHeight;

    nodeEditor.setSize(width, height);
  }

  function showMaterial(mesh) {
    nodeEditor.loadJSON(mesh.toJSON());
  }

  function showMaterial2(mesh) {
    const meshEditor = new MeshEditor(mesh);
    const materialEditor = new StandardMaterialEditor();

    nodeEditor.add(meshEditor);
    nodeEditor.add(materialEditor);
    nodeEditor.centralizeNode(meshEditor);

    const {x, y} = meshEditor.getPosition();

    meshEditor.setPosition(x + 250, y);
    materialEditor.setPosition(x - 250, y);

    meshEditor.material.connect(materialEditor);
  }

  function onWindowResize() {

    const width = window.innerWidth;
    const height = window.innerHeight;

    nodeEditor.setSize(width, height);

  }

  //

  function animate() {

    requestAnimationFrame(animate);

    nodeFrame.update();
  }
</script>

</body>
</html>
